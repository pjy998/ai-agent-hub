# Token Probe 使用指南

## 📖 概述

Token Probe 是一个专为 GitHub Copilot Chat 设计的上下文限制测试工具。它能够自动测试不同模型的最大 Token 上下文长度，帮助开发者了解各个模型的实际处理能力。

## ✨ 主要功能

- 🔍 **自动检测**: 使用二分法自动检测模型的最大 Token 限制
- 🎯 **多模型支持**: 支持 GPT-4.1、GPT-4、GPT-3.5-turbo、Claude-3-Sonnet、Claude-3-Haiku
- 📊 **详细报告**: 生成包含性能分析和使用建议的详细测试报告
- 📈 **历史记录**: 保存测试历史，支持对比分析
- ⚡ **智能优化**: 动态调整测试策略，提高测试效率

## 🚀 快速开始

### 1. 基本使用

在 VS Code 中打开命令面板 (`Ctrl+Shift+P` 或 `Cmd+Shift+P`)，输入以下命令：

```
AI Agent: Token Probe
```

### 2. 选择测试模式

系统会提示您选择测试模式：

- **🚀 快速测试**: 使用预设参数快速测试（推荐新手）
- **📊 标准测试**: 平衡速度和准确性的标准测试
- **🔬 深度测试**: 最高精度的详细测试（耗时较长）
- **⚙️ 自定义测试**: 完全自定义测试参数

### 3. 选择模型

选择要测试的 GitHub Copilot Chat 模型。系统会按提供商分组显示，并标注扣费情况：

#### 🆓 推荐模型（免费）
- **GPT-4.1** - 最新的 GPT-4 模型，支持长上下文 (0x 免费)
- **GPT-4o** - GPT-4 Omni模型，多模态能力 (0x 免费)
- **GPT-5 mini (Preview)** - GPT-5 mini预览版，轻量级模型 (0x 免费)

#### 💰 付费模型
- **GPT-5 (Preview)** - GPT-5预览版，最先进的语言模型 (1x 标准费用)
- **o3-mini** - OpenAI o3-mini模型，推理优化 (0.33x 费用)
- **o4-mini (Preview)** - OpenAI o4-mini预览版 (0.33x 费用)
- **Claude Sonnet 3.5/3.7/4** - Anthropic Claude系列 (1x 标准费用)
- **Gemini 2.5 Pro** - Google Gemini模型 (1x 标准费用)

#### 📋 完整模型列表

| 模型 | 提供商 | 扣费倍数 | 预估Token限制* | 推荐用途 |
|------|--------|----------|---------------|----------|
| GPT-4.1 | OpenAI | 0x (免费) | 128K | 长上下文分析 |
| GPT-4o | OpenAI | 0x (免费) | 128K | 多模态任务 |
| GPT-5 mini | OpenAI | 0x (免费) | 64K | 轻量级任务 |
| GPT-5 | OpenAI | 1x | 200K | 复杂推理 |
| o3-mini | OpenAI | 0.33x | 64K | 推理优化 |
| o4-mini | OpenAI | 0.33x | 64K | 预览功能 |
| Claude Sonnet 3.5 | Anthropic | 1x | 200K | 长文本处理 |
| Claude Sonnet 3.7 | Anthropic | 1x | 200K | 改进版本 |
| Claude Sonnet 4 | Anthropic | 1x | 300K | 最新Claude |
| Gemini 2.5 Pro | Google | 1x | 1M | 超长上下文 |

> ⚠️ **重要说明**: 
> - **预估Token限制仅供参考**: 由于GitHub Copilot通过微软代理访问这些模型，实际的Token限制可能与原厂设置不同
> - **建议使用Token Probe测试**: 为了获得准确的Token限制，强烈建议使用本功能对每个模型进行实际测试
> - **优先选择免费模型**: 建议优先使用GPT-4.1和GPT-4o进行测试，避免不必要的费用

## 📋 命令列表

### 主要命令

| 命令 | 描述 | 快捷键 |
|------|------|--------|
| `AI Agent: Token Probe` | 启动完整的 Token 测试 | - |
| `AI Agent: Token Probe Quick` | 快速测试（使用默认参数） | - |
| `AI Agent: Token Probe History` | 查看测试历史记录 | - |
| `AI Agent: Token Probe Clear History` | 清除测试历史记录 | - |

## ⚙️ 配置选项

### 测试模式配置

#### 快速测试 (Fast)
```json
{
  "initialTokens": 1000,
  "maxTokens": 50000,
  "stepSize": 5000,
  "timeout": 30000,
  "maxRetries": 2
}
```

#### 标准测试 (Standard)
```json
{
  "initialTokens": 1000,
  "maxTokens": 150000,
  "stepSize": 2000,
  "timeout": 60000,
  "maxRetries": 3
}
```

#### 深度测试 (Deep)
```json
{
  "initialTokens": 500,
  "maxTokens": 300000,
  "stepSize": 1000,
  "timeout": 120000,
  "maxRetries": 5
}
```

### 自定义配置

您可以完全自定义测试参数：

- **初始 Token 数**: 测试的起始 Token 数量
- **最大 Token 数**: 测试的上限 Token 数量
- **步长**: 每次增加的 Token 数量
- **超时时间**: 单次请求的超时时间（毫秒）
- **最大重试次数**: 失败时的重试次数
- **测试方法**: 线性搜索或二分法搜索

## 📊 测试报告解读

### 报告结构

测试完成后，系统会生成详细的测试报告，包含以下部分：

#### 1. 📊 测试概览
- 测试的模型名称
- 测试状态（成功/失败）
- 最大 Token 数
- 最大内容长度

#### 2. ⏱️ 时间统计
- 测试开始和结束时间
- 总耗时
- 平均每步耗时

#### 3. 🔍 测试详情
- 总测试步数
- 成功/失败步数统计

#### 4. 📈 性能分析
- 平均成功 Token 数
- 平均响应时间
- Token/字符比率

#### 5. 📋 详细步骤记录
每个测试步骤的详细信息，包括：
- Token 数量
- 内容长度
- 响应时间
- 成功/失败状态
- 错误信息（如有）

#### 6. 💡 建议与总结
基于测试结果的使用建议和最佳实践

### 关键指标说明

- **最大 Token 数**: 模型能够处理的最大 Token 数量
- **Token/字符比**: Token 数量与字符数量的比率，通常在 0.2-0.4 之间
- **成功率**: 测试步骤的成功百分比
- **平均响应时间**: 每次 API 调用的平均耗时

## 🎯 使用场景

### 1. 项目分析前的准备
在进行大型项目分析前，先测试模型的上下文限制，选择合适的分析策略。

### 2. 模型选择
对比不同模型的上下文能力，选择最适合当前任务的模型。

### 3. 性能优化
了解模型的响应时间特性，优化请求策略。

### 4. 成本控制
根据模型的 Token 限制，合理规划 API 使用，控制成本。

## ⚠️ 注意事项

### 测试前准备

1. **确保 GitHub Copilot Chat 正常工作**
   - 检查扩展是否已安装并激活
   - 验证 GitHub Copilot 订阅状态

2. **网络连接稳定**
   - 测试过程需要多次 API 调用
   - 不稳定的网络可能影响测试结果

3. **项目准备**
   - 确保当前工作区包含有效的项目文件
   - 项目结构清晰，便于生成有意义的测试内容

### 测试过程中

1. **避免中断**
   - 测试过程中请勿关闭 VS Code
   - 避免同时进行其他高负载操作

2. **耐心等待**
   - 深度测试可能需要几分钟时间
   - 大型模型的响应时间可能较长

3. **监控进度**
   - 关注进度提示和状态更新
   - 如遇异常可随时取消测试

### 结果解读

1. **理论值 vs 实际值**
   - 实际测试结果可能低于理论上下文限制
   - 这是正常现象，受多种因素影响

2. **安全边距**
   - 建议在实际使用中预留 10-20% 的安全边距
   - 避免接近上下文限制边缘

3. **环境差异**
   - 不同时间、网络环境的测试结果可能有差异
   - 建议多次测试取平均值

## 🔧 故障排除

### 常见问题

#### 1. "GitHub Copilot Chat 扩展未安装"
**解决方案**:
- 在 VS Code 扩展市场搜索并安装 "GitHub Copilot Chat"
- 重启 VS Code 后重试

#### 2. "无法访问 GitHub Copilot Chat API"
**解决方案**:
- 检查 GitHub Copilot 订阅状态
- 确保已登录 GitHub 账户
- 尝试重新激活 Copilot 扩展

#### 3. "测试超时"
**解决方案**:
- 检查网络连接
- 选择较短的超时时间
- 尝试快速测试模式

#### 4. "项目扫描失败"
**解决方案**:
- 确保当前工作区包含有效项目
- 检查文件权限
- 尝试切换到其他项目目录

### 获取帮助

如果遇到其他问题，请：

1. 查看 VS Code 开发者控制台的错误信息
2. 检查 GitHub Copilot 的状态和日志
3. 尝试重启 VS Code 和相关扩展
4. 联系技术支持或提交问题报告

## 📈 最佳实践

### 1. 定期测试
- 建议每月测试一次，了解模型更新情况
- 在重要项目开始前进行测试

### 2. 多模型对比
- 测试多个模型，选择最适合的
- 记录不同模型的特性和适用场景

### 3. 结果记录
- 保存测试历史，建立模型性能数据库
- 分析趋势，优化使用策略

### 4. 团队共享
- 与团队分享测试结果
- 建立统一的模型使用规范

## 🔄 更新日志

### v1.0.0
- 初始版本发布
- 支持 5 种主流模型测试
- 实现二分法和线性搜索
- 提供详细测试报告
- 支持历史记录管理

---

*📅 文档更新时间: 2024年12月*
*🔧 Token Probe v1.0*